// This is your Prisma schema file,
// learn more about it in thedocs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "mysql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model Company {
  id        String    @id @unique
  name      String
  address   String?   @db.Text
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  users     User[]
  patients  Patient[]
}

model User {
  id        Int      @id @default(autoincrement())
  fullName  String
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  role      Role     @relation(fields: [roleId], references: [id])
  roleId    Int
  company   Company? @relation(fields: [companyId], references: [id])
  companyId String?
}

model Role {
  id    Int    @id @default(autoincrement())
  name  String @unique
  users User[]
}

model Patient {
  id           Int         @id @default(autoincrement())
  nik          String      @unique
  patientId    String      @unique
  fullName     String
  email        String?
  dob          DateTime
  age          Int
  gender       String
  position     String
  division     String
  status       String
  location     String
  address      String?     @db.Text
  phoneNumber  String?
  qrCode       String      @db.Text
  mcuPackage   Json
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  company      Company     @relation(fields: [companyId], references: [id])
  companyId    String
  photoUrl     String?     @db.Text
  mcuResults   McuResult[]
  lastProgress String?     @default("MENUNGGU")
}

enum ProgressStatus {
  PENDING
  COMPLETED
  SKIPPED
}

model Checkpoint {
  id         Int           @id @default(autoincrement())
  name       String        @unique
  slug       String        @unique
  createdAt  DateTime      @default(now())
  progresses McuProgress[]
}

model McuProgress {
  id          String         @id @default(cuid())
  status      ProgressStatus @default(PENDING)
  petugasName String?
  completedAt DateTime?
  notes       String?        @db.Text
  mcuResult   McuResult      @relation(fields: [mcuResultId], references: [id], onDelete: Cascade)
  mcuResultId String
  checkpoint  Checkpoint     @relation(fields: [checkpointId], references: [id])
  checkpointId Int

  @@unique([mcuResultId, checkpointId])
}

model McuResult {
  id                     String        @id @default(cuid())
  createdAt              DateTime      @default(now())
  updatedAt              DateTime      @updatedAt
  status                 String        @default("IN_PROGRESS")
  completedAt            DateTime?
  fileUrl                String?       @db.Text
  isExcelDataImported   Boolean     @default(false)
  isImagesUploaded      Boolean     @default(false)
  patient                Patient       @relation(fields: [patientId], references: [id], onDelete: Cascade)
  patientId              Int
  progress               McuProgress[]
  healthHistoryAnswers   Json?
  dassTestAnswers        Json?
  fasTestAnswers         Json?
  formSubmittedAt        DateTime?
  pemeriksaanFisikForm   Json?
  timeCheckIn            String?

  // --- Pemeriksaan Fisik ---
  beratBadan             Float?
  tinggiBadan            Float?
  bmi                    String?       @db.Text
  lingkarPerut           String?       @db.Text
  tekananDarah           String?       @db.Text
  nadi                   String?       @db.Text
  suhu                   String?       @db.Text
  pernafasan             String?       @db.Text
  fisikKondisiUmum       String?       @db.Text
  fisikKesadaran         String?       @db.Text
  fisikKulit             String?       @db.Text
  fisikKepalaLeher       String?       @db.Text

  // --- Mata ---
  visusOd                String?       @db.Text
  visusOs                String?       @db.Text
  butaWarna              String?       @db.Text
  kacamata               String?       @db.Text
  kacamataOd             String?       @db.Text
  kacamataOs             String?       @db.Text
  lapangPandang          String?       @db.Text
  fisikMataLainnya       String?       @db.Text

  // --- Refraktometri BARU ---
  refraKananSpheris     String?     @db.Text
  refraKananChylinder   String?     @db.Text
  refraKananAxis        String?     @db.Text
  refraKananAdd         String?     @db.Text
  refraKiriSpheris      String?     @db.Text
  refraKiriChylinder    String?     @db.Text
  refraKiriAxis         String?     @db.Text
  refraKiriAdd          String?     @db.Text

  // --- THT & Pendengaran ---
  fisikTelinga           String?       @db.Text
  fisikHidung            String?       @db.Text
  fisikTenggorokan       String?       @db.Text

  // --- Sistem Lainnya (Fisik) ---
  fisikKardiovaskular    String?       @db.Text
  fisikPernafasan        String?       @db.Text
  fisikPencernaan        String?       @db.Text
  fisikEkstremitas       String?       @db.Text
  examinationStartedAt   DateTime?

  // --- Hematologi ---
  golonganDarah              String? @db.Text
  hemoglobin                 String? @db.Text
  leukosit                   String? @db.Text
  trombosit                  String? @db.Text
  hematokrit                 String? @db.Text
  eritrosit                  String? @db.Text
  led                        String? @db.Text
  mcv                        String? @db.Text
  mch                        String? @db.Text
  mchc                       String? @db.Text
  rdw                        String? @db.Text
  mpv                        String? @db.Text
  pdw                        String? @db.Text
  hitungJenisEosinofil       String? @db.Text
  hitungJenisBasofil         String? @db.Text
  hitungJenisNeutrofilStab   String? @db.Text
  hitungJenisNeutrofilSegmen String? @db.Text
  hitungJenisLimfosit        String? @db.Text
  hitungJenisMonosit         String? @db.Text

  // --- Kimia Darah ---
  gulaDarahPuasa             String? @db.Text
  gulaDarah2JamPP            String? @db.Text
  gulaDarahSewaktu           String? @db.Text
  sgot                       String? @db.Text
  sgpt                       String? @db.Text
  asamUrat                   String? @db.Text
  kolesterolTotal            String? @db.Text
  trigliserida               String? @db.Text
  ureum                      String? @db.Text
  kreatinin                  String? @db.Text
  hdl                        String? @db.Text
  ldl                        String? @db.Text
  hbsag                      String? @db.Text
  antiHbs                    String? @db.Text
  bilirubinTotal             String? @db.Text
  bilirubinDirect            String? @db.Text
  alkaliPhosphatase          String? @db.Text
  timbalDarah                String? @db.Text
  arsenikUrin                String? @db.Text

  // --- Urinalisa ---
  urinWarna                  String? @db.Text
  urinKejernihan             String? @db.Text
  urinBau                    String? @db.Text
  urinPh                     String? @db.Text
  urinBeratJenis             String? @db.Text
  urinProtein                String? @db.Text
  urinGlukosa                String? @db.Text
  urinBilirubin              String? @db.Text
  urinUrobilinogen           String? @db.Text
  urinKeton                  String? @db.Text
  urinNitrit                 String? @db.Text
  urinLeukositEsterase       String? @db.Text
  urinBlood                  String? @db.Text
  urinSedimenEritrosit       String? @db.Text
  urinSedimenLeukosit        String? @db.Text
  urinSedimenEpitel          String? @db.Text
  urinCaOxalat               String? @db.Text
  urinUridAcid               String? @db.Text
  urinGranulaCast            String? @db.Text

  // --- Penunjang Medis ---
  rontgenImage               String? @db.MediumText
  kesanRontgen               String? @db.Text
  kesanUsgAbdomen            String? @db.Text
  kesanUsgMammae             String? @db.Text

  // --- EKG ---
  ekgImage1                  String? @db.MediumText
  ekgImage2                  String? @db.MediumText
  ekgImage3                  String? @db.MediumText
  ekgRhythm                  String? @db.Text
  ekgQrsRate                 String? @db.Text
  ekgAxis                    String? @db.Text
  ekgPWave                   String? @db.Text
  ekgPrInterval              String? @db.Text
  ekgQrsDuration             String? @db.Text
  ekgQWave                   String? @db.Text
  ekgTWave                   String? @db.Text
  ekgStChanges               String? @db.Text
  ekgOthers                  String? @db.Text
  ekgConclusion              String? @db.Text
  ekgAdvice                  String? @db.Text

  // --- Treadmill ---
  treadmillImage1                String? @db.MediumText
  treadmillImage2                String? @db.MediumText
  treadmillImage3                String? @db.MediumText
  treadmillImage4                String? @db.MediumText
  treadmillLamaLatihan           String? @db.Text
  treadmillKlasifikasiKebugaran  String? @db.Text
  treadmillKerjaFisik            String? @db.Text
  treadmillKelasFungsional       String? @db.Text
  treadmillHasilTest             String? @db.Text
  treadmillSaran                 String? @db.Text

  // --- Audiometry ---
  audioAcKanan250                  Int?
  audioAcKanan500                  Int?
  audioAcKanan1000                 Int?
  audioAcKanan2000                 Int?
  audioAcKanan3000                 Int?
  audioAcKanan4000                 Int?
  audioAcKanan6000                 Int?
  audioAcKanan8000                 Int?
  audioAcKiri250                   Int?
  audioAcKiri500                   Int?
  audioAcKiri1000                  Int?
  audioAcKiri2000                  Int?
  audioAcKiri3000                  Int?
  audioAcKiri4000                  Int?
  audioAcKiri6000                  Int?
  audioAcKiri8000                  Int?
  audioBcKanan250                  Int?
  audioBcKanan500                  Int?
  audioBcKanan1000                 Int?
  audioBcKanan2000                 Int?
  audioBcKanan3000                 Int?
  audioBcKanan4000                 Int?
  audioBcKanan6000                 Int?
  audioBcKanan8000                 Int?
  audioBcKiri250                   Int?
  audioBcKiri500                   Int?
  audioBcKiri1000                  Int?
  audioBcKiri2000                  Int?
  audioBcKiri3000                  Int?
  audioBcKiri4000                  Int?
  audioBcKiri6000                  Int?
  audioBcKiri8000                  Int?
  audiometryKesimpulanTelingaKanan String? @db.Text
  audiometryKesimpulanTelingaKiri  String? @db.Text
  audiometryKesimpulanUmum         String? @db.Text
  audiometrySaran                  String? @db.Text

  // --- Spirometry ---
  spirometryFvc              Float?
  spirometryFvcPred          Float?
  spirometryFvcPost          Float?
  spirometryFev1             Float?
  spirometryFev1Pred         Float?
  spirometryFev1Post         Float?
  spirometryFev1Fvc          Float?
  spirometryFev1FvcPred      Float?
  spirometryFev6             Float?
  spirometryFev6Pred         Float?
  spirometryPef              Float?
  spirometryPefPred          Float?
  spirometryPefPost          Float?
  spirometryFef2575          Float?
  spirometryFef2575Pred      Float?
  spirometryFef25            Float?
  spirometryFef25Pred        Float?
  spirometryFef25Post        Float?
  spirometryFef50            Float?
  spirometryFef50Pred        Float?
  spirometryFef50Post        Float?
  spirometryFef75            Float?
  spirometryFef75Pred        Float?
  spirometryFef75Post        Float?
  spirometryPostBdNote       String? @db.Text
  spirometryQualityAccept    String? @db.Text
  spirometryQualityRepeat    String? @db.Text
  spirometryEffortCount      String? @db.Text
  spirometryImage            String? @db.MediumText
  kesimpulanSpirometry       String? @db.Text

  // --- Framingham ---
  framinghamGender                  String?
  framinghamAge                     String?
  framinghamTotalCholesterol        String?
  framinghamHdlCholesterol          String?
  framinghamSystolicBp              String?
  framinghamIsOnHypertensionTreatment String?
  framinghamIsSmoker                String?
  framinghamRiskPercentage          String?
  framinghamRiskCategory            String?
  framinghamVascularAge             String?

  // --- USG Abdomen ---
  usgAbdomenImage1           String? @db.MediumText
  usgAbdomenImage2           String? @db.MediumText
  usgAbdomenImage3           String? @db.MediumText
  usgAbdomenImage4           String? @db.MediumText
  usgAbdomenImage5           String? @db.MediumText
  usgAbdomenImage6           String? @db.MediumText
  usgAbdomenHepar            String? @db.Text
  usgAbdomenGallBladder      String? @db.Text
  usgAbdomenLien             String? @db.Text
  usgAbdomenPancreas         String? @db.Text
  usgAbdomenGinjalDekstra    String? @db.Text
  usgAbdomenGinjalSinistra   String? @db.Text
  usgAbdomenKesimpulan       String? @db.Text

  // --- USG Mammae ---
  usgMammaeImage1     String? @db.MediumText
  usgMammaeImage2     String? @db.MediumText
  usgMammaeImage3     String? @db.MediumText
  usgMammaeImage4     String? @db.MediumText
  usgMammaeImage5     String? @db.MediumText
  usgMammaeImage6     String? @db.MediumText
  usgMammaeLaporan    String? @db.Text
  usgMammaeKesimpulan String? @db.Text
  kesimpulanTesPsikologi String? @db.Text

  // --- Kesimpulan Akhir ---
  kesimpulan String? @db.Text
  saran      String? @db.Text

  // --- Tanda Tangan Validator untuk setiap seksi ---
  hematologiValidatorName      String?
  hematologiValidatorQr        String? @db.Text
  kimiaDarahValidatorName      String?
  kimiaDarahValidatorQr        String? @db.Text
  biomonitoringValidatorName   String?
  biomonitoringValidatorQr     String? @db.Text
  urinalisaValidatorName       String?
  urinalisaValidatorQr         String? @db.Text
  hepatitisValidatorName       String?
  hepatitisValidatorQr         String? @db.Text
  audiometryValidatorName      String?
  audiometryValidatorQr        String? @db.Text
  spirometryValidatorName      String?
  spirometryValidatorQr        String? @db.Text
  usgAbdomenValidatorName      String?
  usgAbdomenValidatorQr        String? @db.Text
  usgMammaeValidatorName       String?
  usgMammaeValidatorQr         String? @db.Text
  ekgValidatorName             String?
  ekgValidatorQr               String? @db.Text
  treadmillValidatorName       String?
  treadmillValidatorQr         String? @db.Text
  rontgenValidatorName         String?
  rontgenValidatorQr           String? @db.Text
  conclusionValidatorName      String?
  conclusionValidatorQr        String? @db.Text
  dassFasValidatorName         String?
  dassFasValidatorQr           String? @db.Text
  framinghamValidatorName      String?
  framinghamValidatorQr        String? @db.Text

  refraValidatorName           String?
  refraValidatorQr             String? @db.Text
}

model McuSaranTemplate {
  id        String   @id @default(cuid())
  text      String   @unique
  createdAt DateTime @default(now())
}